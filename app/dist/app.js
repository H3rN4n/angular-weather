"use strict";angular.module("weatherModule",["geolocation","angularMoment","ui.bootstrap","ngTouch","ngAnimate"]),angular.module("weatherModule").controller("headerController",["$rootScope","$scope",function(e,t){e.showMenu={state:!1,"class":"ng-hide"},t.show=function(){e.showMenu.state?e.showMenu["class"]="animated slideOutUp":e.showMenu["class"]="animated slideInDown",e.showMenu.state=e.showMenu.state===!1}}]),angular.module("weatherModule").controller("listController",["$rootScope","placesFactory","geolocation","$q",function(e,t,a,r){function n(e,a){a?t.addPlaceByCoords(a).then(function(e){c({goTo:0})}):(t.addPlaceByName(e).then(function(e){c()}),menu.newPlace="")}var o=this;o.active=0,o.places=[],o.initialPlaces=["Mendoza","Lima","San Francisco"],e.$on("updatePlaces",function(e,t){c()});var c=function(e){o.places=t.getPlaces(),o.places.length&&!e?o.active=o.places[o.places.length-1].id:o.active=e.goTo};o.initPlaces=function(){for(var e=0;e<o.initialPlaces.length;e++)t.addPlaceByName(o.initialPlaces[e]);a.getLocation().then(function(e){o.myCoords={lat:e.coords.latitude,"long":e.coords.longitude},n(null,o.myCoords)})}}]),angular.module("weatherModule").controller("menuController",["$rootScope","placesFactory",function(e,t){var a=this;a.places=t.getPlaces();a.addPlace=function(r,n){n||t.addPlaceByName(r).then(function(r){a.places=t.getPlaces(),a.newPlace="",e.$broadcast("updatePlaces",a.places)}),n&&t.addPlaceByCoords(n).then(function(r){a.places=t.getPlaces(),e.$broadcast("updatePlaces",a.places)})},a.removePlace=function(r){a.places=t.removePlace(r),e.$broadcast("updatePlaces",a.places)}}]),angular.module("weatherModule").directive("weatherMenu",[function(){return{restrict:"E",templateUrl:"./menu.html"}}]),angular.module("weatherModule").factory("openWeatherService",["$http",function(e){var t="af95bc4e30710dff7080cfb67eadba30",a="http://api.openweathermap.org/data/2.5/";return{getCurrentWeatherByCityName:function(r,n){return e({url:a+"weather",method:"GET",params:{q:r,appid:t,units:n||"metric"}})},getForecastWeatherByCityName:function(r,n){return e({url:a+"forecast/daily",method:"GET",params:{q:r,appid:t,units:n||"metric",cnt:6}})},getForecastWeatherByCoords:function(r,n){return e({url:a+"forecast/daily",method:"GET",params:{lat:r.lat,lon:r["long"],appid:t,units:n||"metric",cnt:6}})},getWeatherByCoords:function(r,n){return e({url:a+"find",method:"GET",params:{lat:r.lat,lon:r["long"],appid:t,units:n||"metric",cnt:2}})}}}]),angular.module("weatherModule").factory("panoramioService",["$http",function(e){var t="http://www.panoramio.com/map/get_panoramas.php",a=.15;return{getCityImage:function(r){return e({url:t,method:"JSONP",params:{set:"public",from:0,to:1,size:"medium",minx:r.lon-a,maxx:r.lon+a,miny:r.lat-a,maxy:r.lat+a,callback:"JSON_CALLBACK"}})}}}]),angular.module("weatherModule").factory("placesFactory",["$q","openWeatherService","panoramioService",function(e,t,a){var r=[],n=1,o=function(e){return t.getWeatherByCoords(e).then(function(t){return{coords:e,current:t}})},c=function(e){return t.getForecastWeatherByCoords(e.coords).then(function(t){return e.forecast=t,e})},i=function(e){var t={};return t=e.current.data.coord?e.current.data.coord:e.current.data.list[0].coord,a.getCityImage(t).then(function(t){return e.cityImage=t,e})},u=function(t){console.log(t);var a=e.defer();return 200==t.current.data.cod&&200==t.forecast.data.cod?(r.unshift({id:0,img:t.cityImage.data.photos[0].photo_file_url,isCurrentLocation:!0,name:t.forecast.data.city.name,coords:t.coords,state:t.forecast.data.list[1].weather[0].description,min:t.forecast.data.list[1].temp.min,max:t.forecast.data.list[1].temp.max,current:t.current.data.list[1].main.temp,forecast:t.forecast.data.list}),a.resolve(r)):a.reject("Something was wrong"),a.promise},l=function(e){return t.getCurrentWeatherByCityName(e).then(function(t){return{cityName:e,current:t}})},s=function(e){return t.getForecastWeatherByCityName(e.cityName).then(function(t){return e.forecast=t,e})},d=function(t){var a=e.defer();return 200==t.current.data.cod&&200==t.forecast.data.cod?(r.push({id:n,img:t.cityImage.data.photos[0].photo_file_url,isCurrentLocation:!1,name:t.current.data.name,coords:t.current.data.coord,state:t.forecast.data.list[0].weather[0].description,min:t.forecast.data.list[0].temp.min,max:t.forecast.data.list[0].temp.max,current:t.current.data.main.temp,forecast:t.forecast.data.list}),n++,a.resolve(r)):a.reject("Something was wrong"),a.promise};return{getPlaces:function(){return r},removePlace:function(e){return r=r.filter(function(t){return t.name!=e}),this.getPlaces()},addPlaceByCoords:function(e){return o(e).then(c).then(i).then(u)},addPlaceByName:function(e){return l(e).then(s).then(i).then(d)}}}]);